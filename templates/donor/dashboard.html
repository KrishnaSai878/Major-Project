{% extends "base.html" %}
{% block title %}Donor Dashboard - NGO Connect{% endblock %}
{% block content %}
<div class="min-h-screen pt-24 pb-12" style="background:#0b1220;">
  <div class="container mx-auto px-6">
    <div class="rounded-2xl p-6 mb-8" style="background:#0f172a; box-shadow:0 20px 60px rgba(2,6,23,.35) inset, 0 8px 30px rgba(2,6,23,.25);">
      <h1 class="text-3xl font-semibold" style="color:#E5E7EB;">Welcome, {{ donor.user.first_name if donor and donor.user else 'Donor' }}</h1>
      <p class="mt-1" style="color:#9CA3AF;">Your giving impact at a glance.</p>
    </div>

    <div class="grid md:grid-cols-4 gap-6 mb-8">
      <div class="rounded-xl p-6 text-center" style="background:#0f172a; color:#E5E7EB; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <div class="text-2xl" style="color:#8b5cf6;">‚Çπ{{ '%.0f'|format(total_donated or 0) }}</div>
        <div class="mt-1 text-sm" style="color:#94a3b8;">Total Donated</div>
      </div>
      <div class="rounded-xl p-6 text-center" style="background:#0f172a; color:#E5E7EB; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <div class="text-2xl" style="color:#60a5fa;">{{ organizations_supported or 0 }}</div>
        <div class="mt-1 text-sm" style="color:#94a3b8;">Organizations Supported</div>
      </div>
      <div class="rounded-xl p-6 text-center" style="background:#0f172a; color:#E5E7EB; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <div class="text-2xl" style="color:#34d399;">{{ total_donations or 0 }}</div>
        <div class="mt-1 text-sm" style="color:#94a3b8;">Donations Made</div>
      </div>
      <div class="rounded-xl p-6 text-center" style="background:#0f172a; color:#E5E7EB; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <div class="text-2xl" style="color:#a78bfa;">{{ lives_impacted or 0 }}+</div>
        <div class="mt-1 text-sm" style="color:#94a3b8;">Lives Impacted</div>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="rounded-2xl p-6" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <h3 class="text-xl font-semibold mb-4" style="color:#E5E7EB;"><i class="fa-solid fa-magnifying-glass"></i> Discover NGOs</h3>
        <form action="{{ url_for('ngos_directory') }}" method="get" class="grid gap-4">
          <div>
            <label class="block mb-1" style="color:#9CA3AF;">Category</label>
            <select class="w-full h-12 border-2 rounded-lg px-3" name="category">
              <option value="">All Categories</option>
              <option>Education</option>
              <option>Healthcare</option>
              <option>Environment</option>
              <option>Poverty</option>
            </select>
          </div>
          <div>
            <label class="block mb-1" style="color:#9CA3AF;">Location</label>
            <input class="w-full h-12 border-2 rounded-lg px-3" type="text" name="city" placeholder="Enter city or state" />
          </div>
          <div>
            <label class="block mb-1" style="color:#9CA3AF;">Donation Amount</label>
            <select class="w-full h-12 border-2 rounded-lg px-3" name="amount_range">
              <option>Any Amount</option>
              <option>‚Çπ500 - ‚Çπ5,000</option>
              <option>‚Çπ5,000 - ‚Çπ25,000</option>
              <option>‚Çπ25,000+</option>
            </select>
          </div>
          <div>
            <button class="btn btn-accent btn-rounded"><i class="fa-solid fa-magnifying-glass"></i> Search NGOs</button>
          </div>
        </form>
      </div>
      <div class="rounded-2xl p-6" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <h3 class="text-xl font-semibold mb-2" style="color:#E5E7EB;"><i class="fa-solid fa-chart-pie"></i> Donation Impact</h3>
        <p class="mb-4" style="color:#9CA3AF;">Your donations have helped:</p>
        <ul class="space-y-3" style="color:#E5E7EB;">
          <li class="flex items-center justify-between border-b border-slate-700 pb-2"><span><i class="fa-solid fa-graduation-cap"></i> Provide education to 50+ children</span></li>
          <li class="flex items-center justify-between border-b border-slate-700 pb-2"><span><i class="fa-solid fa-heart"></i> Support healthcare for 200+ families</span></li>
          <li class="flex items-center justify-between border-b border-slate-700 pb-2"><span><i class="fa-solid fa-leaf"></i> Plant 500+ trees in communities</span></li>
          <li class="flex items-center justify-between"><span><i class="fa-solid fa-house-chimney"></i> Build 3 homes for families in need</span></li>
        </ul>
      </div>
    </div>

    <div class="rounded-2xl p-0 overflow-hidden mb-8" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
      <div class="p-6 border-b border-slate-800"><h3 class="text-xl font-semibold" style="color:#E5E7EB;"><i class="fa-solid fa-rotate-left"></i> Donation History</h3></div>
      <div class="p-0">
        <table class="table" style="color:#E5E7EB;">
          <thead><tr><th>Organization</th><th>Amount</th><th>Date</th><th>Category</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody>
            {% for d in donations %}
            <tr>
              <td>{{ d.ngo.organization_name if d.ngo else d.ngo_id }}</td>
              <td>‚Çπ{{ d.amount_inr or 0 }}</td>
              <td>{{ (d.created_at.strftime('%b %d, %Y') if d.created_at else '') }}</td>
              <td>{{ d.ngo.category if d.ngo and d.ngo.category else '-' }}</td>
              <td><span class="badge {{ 'badge-success' if d.status=='confirmed' else ('badge-warning' if d.status in ['pending','pending_verification'] else 'badge-danger') }}">{{ d.status }}</span></td>
              <td>
                {% if d.status == 'confirmed' %}
                  <a class="btn btn-secondary btn-rounded" href="{{ url_for('donor_certificate_view', donation_id=d.id) }}">Certificate</a>
                {% else %}
                  <span class="muted">‚Äî</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="muted">No donations</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="rounded-2xl p-6" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <h3 class="text-xl font-semibold mb-4" style="color:#E5E7EB;"><i class="fa-regular fa-star"></i> Recommended NGOs</h3>
        <div class="space-y-6">
          {% for n in (recommended_ngos or all_ngos or [])[:3] %}
          <div class="border-b border-slate-700 pb-4">
            <div class="text-lg" style="color:#E5E7EB;">{{ n.organization_name }}</div>
            <div class="text-sm" style="color:#9CA3AF;">{{ n.category or '‚Äî' }} ‚Ä¢ {{ '4.9‚òÖ rating' }}</div>
            <div class="text-sm mt-1" style="color:#9CA3AF;">{{ (n.description or '')[:120] }}{% if (n.description or '')|length > 120 %}...{% endif %}</div>
            <a class="btn btn-primary btn-rounded mt-3" href="{{ url_for('donation_checkout') }}?ngo={{ n.id }}"><i class="fa-solid fa-heart"></i> Donate Now</a>
          </div>
          {% else %}
          <div class="text-sm" style="color:#9CA3AF;">No recommendations available.</div>
          {% endfor %}
        </div>
      </div>
      <div class="rounded-2xl p-6" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
        <h3 class="text-xl font-semibold mb-4" style="color:#E5E7EB;"><i class="fa-regular fa-gift"></i> Quick Donation</h3>
        <form action="{{ url_for('donation_checkout') }}" method="get" class="space-y-4">
          <div>
            <label for="qd_amount" class="block mb-1" style="color:#9CA3AF;">Amount (‚Çπ)</label>
            <input id="qd_amount" name="amount" type="number" min="1" step="1" required />
          </div>
          <div>
            <label for="qd_ngo" class="block mb-1" style="color:#9CA3AF;">Select NGO</label>
            <select id="qd_ngo" name="ngo" required>
              <option value="">Choose an organization</option>
              {% for n in all_ngos or [] %}
              <option value="{{ n.id }}">{{ n.organization_name }}{% if n.city or n.state %} ‚Äî {{ n.city or '' }}{% if n.city and n.state %}, {% endif %}{{ n.state or '' }}{% endif %}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="qd_message" class="block mb-1" style="color:#9CA3AF;">Message (Optional)</label>
            <textarea id="qd_message" name="message" rows="3" placeholder="Leave a message of support..."></textarea>
          </div>
          <label style="display:flex; align-items:center; gap:.5rem; color:#9CA3AF;">
            <input type="checkbox" name="anonymous" value="true"> Make this donation anonymous
          </label>
          <button type="submit" class="btn btn-accent btn-rounded" style="width:100%;"><i class="fa-solid fa-credit-card"></i> Make Donation</button>
        </form>
      </div>
    </div>

    <div class="rounded-2xl p-6" style="background:#0f172a; box-shadow:0 8px 30px rgba(2,6,23,.25);">
      <h3 class="text-xl font-semibold mb-6" style="color:#E5E7EB;"><i class="fa-solid fa-certificate"></i> Your Certificates</h3>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="text-center rounded-xl p-6" style="background:#0b1220; color:#E5E7EB;">
          <div class="text-3xl mb-2">üåº</div>
          <div class="font-semibold">First Donor</div>
          <div class="text-sm mb-3" style="color:#9CA3AF;">Made your first donation</div>
          <a class="btn btn-secondary btn-rounded" href="{{ url_for('donor_certificates') }}">Download</a>
        </div>
        <div class="text-center rounded-xl p-6" style="background:#0b1220; color:#E5E7EB;">
          <div class="text-3xl mb-2">üèÖ</div>
          <div class="font-semibold">Generous Supporter</div>
          <div class="text-sm mb-3" style="color:#9CA3AF;">Donated over ‚Çπ10,000</div>
          <a class="btn btn-secondary btn-rounded" href="{{ url_for('donor_certificates') }}">Download</a>
        </div>
        <div class="text-center rounded-xl p-6" style="background:#0b1220; color:#E5E7EB;">
          <div class="text-3xl mb-2">‚ù§Ô∏è</div>
          <div class="font-semibold">Community Champion</div>
          <div class="text-sm mb-3" style="color:#9CA3AF;">Supported 5+ organizations</div>
          <a class="btn btn-secondary btn-rounded" href="{{ url_for('donor_certificates') }}">Download</a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
